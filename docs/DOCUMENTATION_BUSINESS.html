<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manufacturing Portal - Documentation M√©tier</title>
    <script src="./mermaid.min.js"></script>
    <style>
        :root {
            --primary-color: #0078d4;
            --secondary-color: #2ecc71;
            --dark-bg: #2c3e50;
            --light-bg: #ecf0f1;
            --text-color: #333;
            --border-color: #ddd;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: #f5f7fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), #005a9e);
            color: white;
            padding: 40px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .version-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .version-info div {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        nav {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        nav h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        nav ol {
            list-style-position: inside;
            padding-left: 10px;
        }

        nav ol li {
            margin: 8px 0;
        }

        nav a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s;
        }

        nav a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        section {
            background: white;
            margin: 30px 0;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 2em;
        }

        h3 {
            color: var(--dark-bg);
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        h4 {
            color: var(--primary-color);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        h5 {
            color: var(--text-color);
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        p {
            margin: 15px 0;
            text-align: justify;
        }

        .mermaid {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin: 25px 0;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        table thead {
            background: var(--primary-color);
            color: white;
        }

        table th,
        table td {
            padding: 15px;
            text-align: left;
            border: 1px solid var(--border-color);
        }

        table tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        table tbody tr:hover {
            background: #f0f8ff;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-test {
            background: #fff3cd;
            color: #856404;
        }

        .status-complete {
            background: #d4edda;
            color: #155724;
        }

        .status-planned {
            background: #d1ecf1;
            color: #0c5460;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            background: #f4f4f4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
        }

        pre code {
            background: none;
            padding: 0;
        }

        .highlight-box {
            background: #e3f2fd;
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .highlight-box.warning {
            background: #fff3cd;
            border-left-color: var(--warning-color);
        }

        .highlight-box.success {
            background: #d4edda;
            border-left-color: var(--success-color);
        }

        .highlight-box.danger {
            background: #f8d7da;
            border-left-color: var(--danger-color);
        }

        .image-container {
            text-align: center;
            margin: 30px 0;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .image-container p {
            font-style: italic;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }

        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }

        li {
            margin: 8px 0;
        }

        strong {
            color: var(--dark-bg);
        }

        footer {
            background: var(--dark-bg);
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 50px;
        }

        footer p {
            margin: 10px 0;
        }

        .emoji {
            font-style: normal;
        }

        @media print {
            body {
                background: white;
            }

            nav {
                position: static;
            }

            section {
                box-shadow: none;
                page-break-inside: avoid;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .version-info {
                flex-direction: column;
                gap: 10px;
            }

            section {
                padding: 20px;
            }

            table {
                font-size: 0.9em;
            }

            table th,
            table td {
                padding: 10px;
            }
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 1000;
        }

        .scroll-to-top:hover {
            background: #005a9e;
            transform: translateY(-5px);
        }

        .scroll-to-top.visible {
            display: flex;
        }
    </style>
</head>
<body>
    <header>
        <h1><span class="emoji">üè≠</span> Manufacturing Portal - Documentation M√©tier</h1>
        <div class="version-info">
            <div><strong>Version :</strong> 1.0</div>
            <div><strong>Date :</strong> 16 octobre 2025</div>
            <div><strong>D√©velopp√© par :</strong> Romain BOTTERO - Alternant Concepteur d'Application</div>
        </div>
    </header>

    <div class="container">
        <nav>
            <h2><span class="emoji">üìã</span> Table des Mati√®res</h2>
            <ol>
                <li><a href="#section-1">Vue d'Ensemble du Portal</a></li>
                <li><a href="#section-2">Architecture et Organisation</a></li>
                <li><a href="#section-3">Les Outils et Workflows</a></li>
                <li><a href="#section-4">D√©ploiement et Infrastructure Azure</a></li>
                <li><a href="#section-5">√âvolutions Futures</a></li>
            </ol>
        </nav>

        <section id="section-1">
            <h2>1. Vue d'Ensemble du Portal</h2>

            <h3>Contexte & Objectif</h3>
            <p>Le <strong>Manufacturing Portal</strong> est une plateforme web centralis√©e d√©velopp√©e pour B√©n√©teau qui regroupe plusieurs outils de production. L'objectif est de <strong>simplifier et standardiser</strong> l'acc√®s aux outils num√©riques utilis√©s sur les sites de production.</p>

            <h3>Principe Fondamental</h3>
            <p>Au lieu de d√©velopper chaque outil de mani√®re isol√©e, nous avons construit une <strong>infrastructure commune</strong> o√π chaque nouvel outil b√©n√©ficie automatiquement de composants, services et fonctionnalit√©s partag√©s.</p>

            <div class="mermaid">
flowchart TB
    Portal["üè≠ Manufacturing Portal<br/>(Plateforme Commune)"]
    
    Portal --> Tool1["üö¢ Boat Configuration Editor"]
    Portal --> Tool2["üè∑Ô∏è Part Printer"]
    Portal --> Tool3["üîß Outil 3 (√† venir)"]
    Portal --> ToolN["... + 5 outils pr√©vus"]
    
    style Portal fill:#4a90e2,stroke:#2c5aa0,color:#fff
    style Tool1 fill:#50c878,stroke:#2d7a4a,color:#fff
    style Tool2 fill:#50c878,stroke:#2d7a4a,color:#fff
    style Tool3 fill:#ddd,stroke:#999,color:#666
    style ToolN fill:#ddd,stroke:#999,color:#666
            </div>

            <h3>√âtat Actuel</h3>
            <table>
                <thead>
                    <tr>
                        <th>Outil</th>
                        <th>Statut</th>
                        <th>D√©ploiement</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Boat Configuration Editor</strong></td>
                        <td><span class="status-badge status-test">üß™ En phase de test</span></td>
                        <td>Novembre 2025</td>
                    </tr>
                    <tr>
                        <td><strong>Part Printer</strong></td>
                        <td><span class="status-badge status-test">üß™ En phase de test</span></td>
                        <td>Novembre 2025</td>
                    </tr>
                    <tr>
                        <td><strong>5+ outils futurs</strong></td>
                        <td><span class="status-badge status-planned">üìã Planifi√©</span></td>
                        <td>2026+</td>
                    </tr>
                </tbody>
            </table>

            <h3>Interface du Portal</h3>
            <div class="image-container">
                <img src="tools/acceuil.png" alt="Page d'accueil du Manufacturing Portal">
                <p>Page d'accueil centralis√©e donnant acc√®s aux diff√©rents outils de production</p>
            </div>

            <h3>Valeur Ajout√©e</h3>
            
            <div class="highlight-box success">
                <h4>Pour les op√©rateurs :</h4>
                <ul>
                    <li>Interface unique et coh√©rente pour tous les outils</li>
                    <li>Acc√®s centralis√© avec authentification unique (Azure AD)</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h4>Pour l'entreprise :</h4>
                <ul>
                    <li>R√©duction des co√ªts de d√©veloppement (r√©utilisation du code)</li>
                    <li>Maintenance simplifi√©e (un seul codebase)</li>
                    <li>D√©ploiement plus rapide de nouveaux outils</li>
                    <li>√âvolutivit√© garantie</li>
                </ul>
            </div>
        </section>

        <section id="section-2">
            <h2>2. Architecture et Organisation</h2>

            <h3>2.1 Architecture Partag√©e vs Sp√©cifique</h3>
            <p>Le Manufacturing Portal utilise une architecture <strong>modulaire</strong> qui s√©pare clairement ce qui est commun de ce qui est sp√©cifique √† chaque outil.</p>

            <div class="mermaid">
flowchart LR
    subgraph Shared["üì¶ COMMUN (Shared)"]
        SharedUI["Interface utilisateur<br/>commune"]
        SharedAPI["Connexion IFS Cloud<br/>centralis√©e"]
        SharedPrint["Service<br/>d'impression"]
    end
    
    subgraph Tool1["üö¢ Boat Config"]
        BC_Logic["Logique m√©tier<br/>Shop Orders"]
        BC_UI["Composants<br/>sp√©cifiques"]
    end
    
    subgraph Tool2["üè∑Ô∏è Part Printer"]
        PP_Logic["Logique m√©tier<br/>√âtiquettes"]
        PP_UI["Composants<br/>sp√©cifiques"]
    end
    
    Shared --> Tool1
    Shared --> Tool2
    
    style Shared fill:#4a90e2,stroke:#2c5aa0,color:#fff
    style Tool1 fill:#50c878,stroke:#2d7a4a,color:#fff
    style Tool2 fill:#50c878,stroke:#2d7a4a,color:#fff
            </div>

            <div class="highlight-box">
                <p><strong>Principe :</strong> Tout ce qui est utilis√© par au moins 2 outils est plac√© dans <code>shared/</code> (partag√©). Ce qui est propre √† un seul outil reste dans son dossier d√©di√©.</p>
            </div>

            <h3>2.2 Groupement de Routes (Route Grouping)</h3>
            <p>Le portal utilise une technique d'organisation appel√©e <strong>route grouping</strong> qui permet de structurer le code sans affecter les URLs visibles par les utilisateurs.</p>

            <div class="highlight-box">
                <h4>URL visible par l'utilisateur :</h4>
                <ul>
                    <li><code>https://portal.beneteau.com/boat-configuration</code></li>
                    <li><code>https://portal.beneteau.com/part-printer</code></li>
                </ul>

                <h4>Organisation du code (invisible pour l'utilisateur) :</h4>
                <ul>
                    <li><code>src/app/(tools)/boat-configuration/</code></li>
                    <li><code>src/app/(tools)/part-printer/</code></li>
                </ul>

                <p><strong>Avantage :</strong> Le dossier <code>(tools)</code> permet de regrouper tous les outils dans le code sans que cela n'apparaisse dans l'URL. Cela facilite la maintenance et la navigation dans le projet.</p>
            </div>

            <h3>2.3 Structure du Code</h3>
            <div class="mermaid">
flowchart TD
    Root["Manufacturing Portal"]
    
    Root --> Shared["üì¶ shared/<br/>(Code Partag√©)"]
    Root --> Tools["üîß tools/<br/>(Code Sp√©cifique)"]
    Root --> AppTools["üé® app/(tools)/<br/>(Pages & Interface)"]
    
    Shared --> SharedComp["Composants UI<br/>r√©utilisables"]
    Shared --> SharedServ["Services IFS<br/>communs"]
    Shared --> SharedTypes["Types de donn√©es<br/>partag√©s"]
    
    Tools --> ToolBC["boat-configuration/<br/>Services m√©tier"]
    Tools --> ToolPP["part-printer/<br/>Services m√©tier"]
    
    AppTools --> PageBC["boat-configuration/<br/>Interface utilisateur"]
    AppTools --> PagePP["part-printer/<br/>Interface utilisateur"]
    
    style Root fill:#2c3e50,stroke:#1a252f,color:#fff
    style Shared fill:#4a90e2,stroke:#2c5aa0,color:#fff
    style Tools fill:#f39c12,stroke:#d68910,color:#fff
    style AppTools fill:#9b59b6,stroke:#7d3c98,color:#fff
            </div>

            <div class="highlight-box">
                <h4>Organisation en 3 niveaux :</h4>
                <ol>
                    <li><strong>shared/</strong> : Tout ce qui est r√©utilisable (boutons, connexion IFS, impression)</li>
                    <li><strong>tools/</strong> : La logique m√©tier propre √† chaque outil (calculs, r√®gles de gestion)</li>
                    <li><strong>app/(tools)/</strong> : Les pages et l'interface visuelle de chaque outil</li>
                </ol>
            </div>

            <h3>2.4 Flux de Donn√©es et Authentification</h3>
            <p>Le sch√©ma suivant montre comment les donn√©es circulent depuis IFS Cloud jusqu'√† l'utilisateur, en passant par l'authentification Azure AD :</p>

            <div class="mermaid">
flowchart TD
    User["üë§ Op√©rateur"] --> Login["üîê Azure AD<br/>Authentification SSO"]
    Login --> Token["üé´ JWT Token<br/>(2h validit√©)"]
    Token --> Portal["üè≠ Portal<br/>Session active"]
    
    Portal --> Request["üì§ Requ√™te<br/>utilisateur"]
    Request --> API["üîå API Routes<br/>(app/api/)"]
    API --> Auth["üîí V√©rification<br/>Token"]
    Auth --> Services["‚öôÔ∏è Services M√©tier<br/>(tools/)"]
    Services --> IFSAuth["üîë OAuth2<br/>IFS Cloud"]
    IFSAuth --> IFS["‚òÅÔ∏è IFS Cloud<br/>(Base de donn√©es)"]
    
    IFS --> Response["üì¶ Donn√©es"]
    Response --> Services
    Services --> API
    API --> Portal
    Portal --> User
    
    style User fill:#34495e,stroke:#2c3e50,color:#fff
    style Login fill:#0078d4,stroke:#005a9e,color:#fff
    style Token fill:#50c878,stroke:#2d7a4a,color:#fff
    style Portal fill:#4a90e2,stroke:#2c5aa0,color:#fff
    style Auth fill:#f39c12,stroke:#d68910,color:#fff
    style Services fill:#3498db,stroke:#2980b9,color:#fff
    style IFSAuth fill:#9b59b6,stroke:#7d3c98,color:#fff
    style IFS fill:#e74c3c,stroke:#c0392b,color:#fff
            </div>

            <div class="highlight-box success">
                <h4>Double s√©curit√© :</h4>
                <ul>
                    <li><strong>Azure AD</strong> : Authentification de l'utilisateur (qui est-il ?)</li>
                    <li><strong>OAuth2 IFS</strong> : Autorisation d'acc√®s aux donn√©es IFS (que peut-il faire ?)</li>
                </ul>

                <h4>Session utilisateur :</h4>
                <ul>
                    <li>Dur√©e : 2 heures d'inactivit√©</li>
                    <li>Renouvellement : Automatique en arri√®re-plan</li>
                    <li>D√©connexion : Manuelle ou expiration automatique</li>
                </ul>
            </div>
        </section>

        <section id="section-3">
            <h2>3. Les Outils et Workflows</h2>

            <h3>3.1 Boat Configuration Editor</h3>

            <h4>Objectif M√©tier</h4>
            <p>Permettre aux op√©rateurs d'<strong>imprimer rapidement</strong> les documents de configuration des bateaux (formulaire MA_FO_CR_1419) en recherchant un Shop Order dans IFS Cloud.</p>

            <h4>Workflow Simplifi√©</h4>
            <div class="mermaid">
flowchart LR
    A["üìù Saisie<br/>Shop Order"] --> B["üîç Recherche<br/>dans IFS"]
    B --> C["üìä R√©cup√©ration<br/>Serial Number"]
    C --> D["üñ®Ô∏è S√©lection<br/>imprimante"]
    D --> E["‚úÖ Impression<br/>document"]
    
    style A fill:#3498db,stroke:#2980b9,color:#fff
    style B fill:#3498db,stroke:#2980b9,color:#fff
    style C fill:#3498db,stroke:#2980b9,color:#fff
    style D fill:#3498db,stroke:#2980b9,color:#fff
    style E fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>

            <h4>Probl√®me R√©solu</h4>
            <div class="highlight-box warning">
                <p><strong>Avant :</strong> L'op√©rateur devait naviguer dans plusieurs √©crans IFS, noter manuellement le Serial Number, puis lancer l'impression.</p>
            </div>
            <div class="highlight-box success">
                <p><strong>Apr√®s :</strong> L'op√©rateur saisit uniquement le num√©ro de Shop Order. Le syst√®me r√©cup√®re automatiquement toutes les informations n√©cessaires et imprime en un clic.</p>
            </div>

            <h4>Statut</h4>
            <p><span class="status-badge status-test">üß™ En phase de test</span> - D√©ploiement pr√©vu novembre 2025</p>

            <h4>Interface de l'Outil</h4>
            <div class="image-container">
                <img src="tools/boatconfigeditor.png" alt="Interface Boat Configuration Editor">
                <p>Interface de recherche et d'impression des configurations de bateaux</p>
            </div>

            <h3>3.2 Part Printer (√âtiquettes Bois)</h3>

            <h4>Objectif M√©tier</h4>
            <p>Automatiser l'<strong>impression d'√©tiquettes</strong> pour les pi√®ces en bois en consolidant les informations provenant de plusieurs sources IFS Cloud (Shop Orders, op√©rations, caract√©ristiques techniques).</p>

            <h4>Workflow Simplifi√©</h4>
            <div class="mermaid">
flowchart TD
    A["üîé Filtres<br/>(Site, Date, Ligne)"] --> B["üìã Liste des<br/>Shop Orders"]
    B --> C["üîç Extraction<br/>donn√©es techniques"]
    C --> D["üìä Consolidation<br/>& groupement"]
    D --> E["üìÑ G√©n√©ration<br/>PDF √©tiquettes"]
    E --> F["üñ®Ô∏è Impression<br/>par lot"]
    
    style A fill:#9b59b6,stroke:#7d3c98,color:#fff
    style B fill:#9b59b6,stroke:#7d3c98,color:#fff
    style C fill:#9b59b6,stroke:#7d3c98,color:#fff
    style D fill:#9b59b6,stroke:#7d3c98,color:#fff
    style E fill:#9b59b6,stroke:#7d3c98,color:#fff
    style F fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>

            <h4>Complexit√© Technique</h4>
            <p>Cet outil n√©cessite d'interroger <strong>5 endpoints diff√©rents</strong> dans IFS Cloud pour consolider les informations d'une seule √©tiquette. Cette complexit√© a n√©cessit√© un <strong>travail approfondi d'exploration et d'analyse</strong> des APIs IFS Cloud.</p>

            <h5>Traitement Complexe des Donn√©es</h5>

            <p><strong>√âtape 1 : Collecte Multi-Sources</strong></p>
            <div class="mermaid">
flowchart TB
    subgraph IFS["‚òÅÔ∏è IFS Cloud"]
        SO["Shop Order<br/>OrderNo, PartNo"]
        MAT["Material Lines<br/>Raw Material"]
        OP["Operations<br/>Block ID OP10"]
        PART["Master Part<br/>TechnicalSpecNo"]
        ATTR["Technical Attributes<br/>50+ attributs"]
    end
    
    subgraph Extraction["üîç Extraction"]
        E1["R√©cup√©ration<br/>Shop Order"]
        E2["Navigation<br/>MaterialArray"]
        E3["Requ√™te<br/>Operation 10"]
        E4["Navigation<br/>PartCatalog"]
        E5["Filtrage<br/>TechnicalSpec"]
    end
    
    SO --> E1
    MAT --> E2
    OP --> E3
    PART --> E4
    ATTR --> E5
    
    style IFS fill:#e74c3c,stroke:#c0392b,color:#fff
    style Extraction fill:#3498db,stroke:#2980b9,color:#fff
            </div>

            <p><strong>√âtape 2 : Navigation OData Multi-Niveaux</strong></p>
            <div class="mermaid">
flowchart LR
    Start["üéØ Shop Order<br/>454853"] --> Nav1["Navigation 1<br/>MaterialArray"]
    Nav1 --> Filter1["Filtrage<br/>OperationNo = 10"]
    Filter1 --> Result1["‚úÖ Raw Material<br/>D8588H"]
    
    Start --> Nav2["Navigation 2<br/>PartCatalogArray"]
    Nav2 --> Nav3["Navigation 3<br/>TechnicalSpecBothArray"]
    Nav3 --> Filter2["Filtrage par<br/>attribut sp√©cifique"]
    Filter2 --> Result2["‚úÖ Generic Code<br/>Length Setup<br/>Varnish Code"]
    
    style Start fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Nav1 fill:#3498db,stroke:#2980b9,color:#fff
    style Nav2 fill:#3498db,stroke:#2980b9,color:#fff
    style Nav3 fill:#3498db,stroke:#2980b9,color:#fff
    style Filter1 fill:#f39c12,stroke:#d68910,color:#fff
    style Filter2 fill:#f39c12,stroke:#d68910,color:#fff
    style Result1 fill:#2ecc71,stroke:#27ae60,color:#fff
    style Result2 fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>

            <p><strong>√âtape 3 : Consolidation & G√©n√©ration</strong></p>
            <div class="mermaid">
flowchart TD
    subgraph Sources["üìä Donn√©es Collect√©es"]
        D1["Shop Order<br/>454853"]
        D2["Raw Material<br/>D8588H"]
        D3["Block ID<br/>B25"]
        D4["Generic Code<br/>1000014690"]
        D5["Length<br/>1904mm"]
        D6["Varnish<br/>RCTV1210"]
    end
    
    subgraph Consolidation["‚öôÔ∏è Consolidation"]
        C1["Validation<br/>donn√©es compl√®tes"]
        C2["Groupement par<br/>Raw Material & Varnish"]
        C3["Tri par<br/>Length d√©croissant"]
    end
    
    subgraph Output["üìÑ G√©n√©ration"]
        O1["Code-barres<br/>CODE128"]
        O2["√âtiquette PDF<br/>A4 paysage"]
        O3["Lot d'impression<br/>group√©"]
    end
    
    D1 & D2 & D3 & D4 & D5 & D6 --> C1
    C1 --> C2
    C2 --> C3
    C3 --> O1 & O2 & O3
    
    style Sources fill:#e74c3c,stroke:#c0392b,color:#fff
    style Consolidation fill:#f39c12,stroke:#d68910,color:#fff
    style Output fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>

            <p>Cette architecture de traitement permet de <strong>transformer des donn√©es complexes et √©parpill√©es</strong> en √©tiquettes pr√™tes √† l'impression, tout en optimisant les performances gr√¢ce √† des requ√™tes cibl√©es.</p>

            <h4>Types d'√âtiquettes</h4>
            <ol>
                <li><strong>D√©bit classique</strong> : √âtiquettes pour les nouvelles pi√®ces √† d√©biter</li>
                <li><strong>Red√©bit</strong> : √âtiquettes pour les pi√®ces n√©cessitant un second d√©bit</li>
            </ol>
            <p>Chaque mode a ses propres r√®gles m√©tier qui sont automatiquement appliqu√©es par l'outil.</p>

            <h4>Statut</h4>
            <p><span class="status-badge status-test">üß™ En phase de test</span> - D√©ploiement pr√©vu novembre 2025</p>

            <h4>Interface de l'Outil</h4>
            <div class="image-container">
                <img src="tools/partprinter.png" alt="Interface Part Printer">
                <p>Interface de filtrage et de g√©n√©ration d'√©tiquettes pour les pi√®ces en bois</p>
            </div>

            <h3>3.3 Comparaison des Outils</h3>
            <table>
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>Boat Configuration Editor</th>
                        <th>Part Printer</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Complexit√©</strong></td>
                        <td>üü¢ Simple (3 √©tapes)</td>
                        <td>üü† Complexe (7 √©tapes)</td>
                    </tr>
                    <tr>
                        <td><strong>Sources IFS</strong></td>
                        <td>2 endpoints</td>
                        <td>5+ endpoints</td>
                    </tr>
                    <tr>
                        <td><strong>Volume</strong></td>
                        <td>1 document √† la fois</td>
                        <td>Batch (10-100 √©tiquettes)</td>
                    </tr>
                    <tr>
                        <td><strong>Utilisateurs</strong></td>
                        <td>Sites d'assemblage</td>
                        <td>Ateliers bois</td>
                    </tr>
                </tbody>
            </table>

            <h3>3.4 Traitement des Donn√©es : De l'API √† l'√âtiquette</h3>
            <p>Les deux outils illustrent diff√©rents niveaux de complexit√© dans le traitement des donn√©es IFS.</p>

            <h4>Boat Configuration Editor : Workflow Simple</h4>
            <div class="mermaid">
flowchart LR
    Input["üìù Shop Order<br/>97277"] --> API1["üîå API 1<br/>ShopOrderHandling"]
    API1 --> Parse["‚öôÔ∏è Extraction<br/>DOP ID"]
    Parse --> API2["üîå API 2<br/>DopHeaderHandling"]
    API2 --> Output["‚úÖ Serial Number<br/>LG5MA0114"]
    
    style Input fill:#3498db,stroke:#2980b9,color:#fff
    style API1 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Parse fill:#f39c12,stroke:#d68910,color:#fff
    style API2 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Output fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>
            <p><strong>Principe :</strong> Traitement lin√©aire avec 2 APIs en s√©quence.</p>

            <h4>Part Printer : Workflow Complexe</h4>
            <div class="mermaid">
flowchart TD
    Input["üìù Filtres<br/>Site + Date"] --> API1["üîå API 1<br/>ShopOrds"]
    API1 --> SO["Shop Order<br/>454853"]
    
    SO --> Branch1["üîÄ Parall√©lisation"]
    
    Branch1 --> API2["üîå API 2<br/>MaterialArray"]
    Branch1 --> API3["üîå API 3<br/>OperationBlock"]
    Branch1 --> API4["üîå API 4<br/>PartCatalog"]
    
    API2 --> D1["Raw Material"]
    API3 --> D2["Block ID"]
    API4 --> API5["üîå API 5<br/>TechnicalSpec"]
    
    API5 --> D3["Generic Code"]
    API5 --> D4["Length Setup"]
    API5 --> D5["Varnish Code"]
    
    D1 & D2 & D3 & D4 & D5 --> Merge["‚öôÔ∏è Consolidation"]
    Merge --> Barcode["üìä Code-barres"]
    Barcode --> PDF["üìÑ PDF √âtiquette"]
    
    style Input fill:#3498db,stroke:#2980b9,color:#fff
    style API1 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style API2 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style API3 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style API4 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style API5 fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Branch1 fill:#e74c3c,stroke:#c0392b,color:#fff
    style Merge fill:#f39c12,stroke:#d68910,color:#fff
    style PDF fill:#2ecc71,stroke:#27ae60,color:#fff
            </div>
            <p><strong>Principe :</strong> Traitement parall√®le avec 5 APIs et consolidation finale.</p>
            <div class="highlight-box">
                <p><strong>Diff√©rence cl√© :</strong> Le Part Printer n√©cessite une orchestration complexe de multiples sources de donn√©es et une logique de consolidation avanc√©e.</p>
            </div>
        </section>

        <section>
            <h2>Annexe : M√©thodologie d'Exploration IFS Cloud</h2>
            <p>Le d√©veloppement des outils a n√©cessit√© une <strong>m√©thodologie rigoureuse</strong> pour comprendre et exploiter les APIs IFS Cloud.</p>

            <h3>Approche It√©rative</h3>
            <div class="mermaid">
flowchart LR
    A["üìã Besoin<br/>m√©tier"] --> B["üîç Exploration<br/>APIs IFS"]
    B --> C["üß™ Tests<br/>endpoints"]
    C --> D{"‚úÖ Donn√©es<br/>correctes?"}
    D -->|Non| B
    D -->|Oui| E["‚öôÔ∏è Impl√©mentation<br/>service"]
    E --> F["‚úÖ Validation"]
    
    style A fill:#3498db,stroke:#2980b9,color:#fff
    style B fill:#f39c12,stroke:#d68910,color:#fff
    style C fill:#9b59b6,stroke:#7d3c98,color:#fff
    style D fill:#e74c3c,stroke:#c0392b,color:#fff
    style E fill:#2ecc71,stroke:#27ae60,color:#fff
    style F fill:#27ae60,stroke:#1e8449,color:#fff
            </div>

            <h3>Techniques Utilis√©es</h3>
            <ol>
                <li><strong>Analyse des m√©tadonn√©es OData</strong> : √âtude des <code>$metadata</code> pour comprendre la structure</li>
                <li><strong>Navigation progressive</strong> : Tests des relations entre entit√©s (<code>NavigationProperty</code>)</li>
                <li><strong>Optimisation des filtres</strong> : Utilisation de <code>$filter</code>, <code>$select</code>, <code>$expand</code> pour limiter les donn√©es</li>
                <li><strong>Documentation syst√©matique</strong> : Chaque d√©couverte document√©e pour r√©f√©rence future</li>
            </ol>

            <h3>Exemple Concret : Extraction Raw Material</h3>
            <div class="highlight-box warning">
                <p><strong>Probl√®me :</strong> Aucun endpoint direct pour r√©cup√©rer les mati√®res premi√®res d'une op√©ration.</p>
            </div>
            <div class="highlight-box success">
                <p><strong>Solution trouv√©e :</strong></p>
                <ul>
                    <li>Navigation OData : <code>ShopOrds(...)/MaterialArray</code></li>
                    <li>Filtrage c√¥t√© code pour isoler l'op√©ration 10 (OP10)</li>
                    <li>R√©sultat : Acc√®s aux donn√©es sans endpoint d√©di√©</li>
                </ul>
            </div>
            <p>Cette approche m√©thodique a permis de <strong>surmonter les limitations</strong> de la documentation IFS et d'exploiter pleinement les capacit√©s de l'API OData.</p>
        </section>

        <section id="section-4">
            <h2>4. D√©ploiement et Infrastructure Azure</h2>

            <h3>4.1 Architecture de D√©ploiement</h3>
            <p>Le Manufacturing Portal est con√ßu pour √™tre d√©ploy√© sur <strong>Microsoft Azure</strong> avec une infrastructure moderne et s√©curis√©e.</p>

            <div class="mermaid">
flowchart TB
    subgraph Azure["‚òÅÔ∏è Microsoft Azure"]
        subgraph Auth["üîê Authentification"]
            AzureAD["Azure Active Directory<br/>(SSO Entreprise)"]
            AppReg["App Registration<br/>(OAuth2 Client)"]
        end
        
        subgraph Envs["üåç Environnements"]
            Dev["DEV<br/>Azure App Service"]
            PreProd["PRE-PROD<br/>Azure App Service"]
            Prod["PROD<br/>Azure App Service"]
        end
        
        subgraph Pipeline["üîÑ CI/CD"]
            GitHub["GitHub Actions<br/>(Source Code)"]
            Build["Build & Test<br/>(Node.js)"]
            Deploy["Deployment<br/>(Automatique)"]
        end
        
        AzureAD --> AppReg
        AppReg --> Dev
        AppReg --> PreProd
        AppReg --> Prod
        
        GitHub --> Build
        Build --> Deploy
        Deploy --> Dev
        Deploy --> PreProd
        Deploy --> Prod
    end
    
    Users["üë• Utilisateurs<br/>B√©n√©teau"] --> AzureAD
    
    style Azure fill:#0078d4,stroke:#005a9e,color:#fff
    style Auth fill:#50c878,stroke:#2d7a4a,color:#fff
    style Envs fill:#f39c12,stroke:#d68910,color:#fff
    style Pipeline fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Users fill:#34495e,stroke:#2c3e50,color:#fff
            </div>

            <h3>4.2 Authentification Azure AD</h3>

            <h4>Configuration Technique Azure AD</h4>
            <p>L'authentification utilise <strong>Azure Active Directory</strong> pour permettre aux utilisateurs de se connecter avec leurs identifiants B√©n√©teau (Single Sign-On).</p>

            <div class="highlight-box">
                <p><strong>App Registration Azure AD :</strong></p>
                <ul>
                    <li>Type : Web Application</li>
                    <li>Redirect URI : <code>https://portal.beneteau.com/api/auth/callback/azure-ad</code></li>
                    <li>Permissions API : <code>User.Read</code> (profil utilisateur basique)</li>
                    <li>Token : JWT avec dur√©e de vie de 2 heures</li>
                </ul>
            </div>

            <p><strong>Variables d'environnement requises :</strong></p>
            <pre><code>AZURE_AD_CLIENT_ID=&lt;Application (client) ID&gt;
AZURE_AD_CLIENT_SECRET=&lt;Client Secret&gt;
AZURE_AD_TENANT_ID=&lt;Directory (tenant) ID&gt;
NEXTAUTH_URL=https://portal.beneteau.com
NEXTAUTH_SECRET=&lt;Random Secret Key&gt;</code></pre>

            <div class="highlight-box success">
                <p><strong>S√©curit√© :</strong></p>
                <ul>
                    <li>‚úÖ Tokens stock√©s c√¥t√© serveur uniquement</li>
                    <li>‚úÖ Session expiration apr√®s 2 heures d'inactivit√©</li>
                    <li>‚úÖ Refresh automatique du token</li>
                    <li>‚úÖ D√©connexion automatique en cas d'expiration</li>
                </ul>
            </div>

            <h3>4.3 Environnements et Pipeline CI/CD</h3>

            <h4>Les 3 Environnements</h4>
            <table>
                <thead>
                    <tr>
                        <th>Environnement</th>
                        <th>URL</th>
                        <th>Usage</th>
                        <th>Auto-Deploy</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>DEV</strong></td>
                        <td><code>https://portal-dev.beneteau.com</code></td>
                        <td>Tests d√©veloppeurs</td>
                        <td>‚úÖ Oui (branche <code>dev</code>)</td>
                    </tr>
                    <tr>
                        <td><strong>PRE-PROD</strong></td>
                        <td><code>https://portal-preprod.beneteau.com</code></td>
                        <td>Validation m√©tier</td>
                        <td>‚úÖ Oui (branche <code>staging</code>)</td>
                    </tr>
                    <tr>
                        <td><strong>PROD</strong></td>
                        <td><code>https://portal.beneteau.com</code></td>
                        <td>Utilisation r√©elle</td>
                        <td>‚ö†Ô∏è Manuel (branche <code>main</code>)</td>
                    </tr>
                </tbody>
            </table>

            <h4>Pipeline CI/CD GitHub Actions</h4>
            <div class="mermaid">
flowchart TD
    Push["üì§ Push Code<br/>GitHub"] --> Trigger["üîî D√©clenchement<br/>Pipeline"]
    
    Trigger --> Build["üî® Build"]
    Build --> BuildSteps["Node.js 18<br/>pnpm install<br/>pnpm build"]
    
    BuildSteps --> Test["üß™ Tests"]
    Test --> TestSteps["ESLint<br/>TypeScript Check<br/>Unit Tests"]
    
    TestSteps --> Check{"‚úÖ Tests<br/>OK?"}
    Check -->|‚ùå Non| Fail["‚ùå Pipeline Failed<br/>Notification"]
    
    Check -->|‚úÖ Oui| Deploy{"üåç Env?"}
    
    Deploy -->|dev| DevDeploy["üöÄ Deploy DEV<br/>Azure App Service"]
    Deploy -->|staging| PreProdDeploy["üöÄ Deploy PRE-PROD<br/>Azure App Service"]
    Deploy -->|main| ManualApprove["üë§ Approbation<br/>Manuelle"]
    
    ManualApprove --> ProdDeploy["üöÄ Deploy PROD<br/>Azure App Service"]
    
    DevDeploy --> Success["‚úÖ D√©ploiement<br/>R√©ussi"]
    PreProdDeploy --> Success
    ProdDeploy --> Success
    
    style Push fill:#3498db,stroke:#2980b9,color:#fff
    style Build fill:#f39c12,stroke:#d68910,color:#fff
    style Test fill:#9b59b6,stroke:#7d3c98,color:#fff
    style Check fill:#e74c3c,stroke:#c0392b,color:#fff
    style DevDeploy fill:#2ecc71,stroke:#27ae60,color:#fff
    style PreProdDeploy fill:#2ecc71,stroke:#27ae60,color:#fff
    style ProdDeploy fill:#27ae60,stroke:#1e8449,color:#fff
    style Success fill:#27ae60,stroke:#1e8449,color:#fff
            </div>

            <h4>Strat√©gie de D√©ploiement</h4>

            <div class="highlight-box">
                <p><strong>DEV</strong> : D√©ploiement continu automatique</p>
                <ul>
                    <li>Chaque commit sur <code>dev</code> ‚Üí d√©ploiement imm√©diat</li>
                    <li>Tests de nouvelles fonctionnalit√©s</li>
                    <li>Pas de validation requise</li>
                </ul>
            </div>

            <div class="highlight-box warning">
                <p><strong>PRE-PROD</strong> : D√©ploiement automatique avec validation</p>
                <ul>
                    <li>Merge <code>dev</code> ‚Üí <code>staging</code> ‚Üí d√©ploiement automatique</li>
                    <li>Tests d'acceptation utilisateur (UAT)</li>
                    <li>Validation m√©tier avant production</li>
                </ul>
            </div>

            <div class="highlight-box danger">
                <p><strong>PROD</strong> : D√©ploiement manuel contr√¥l√©</p>
                <ul>
                    <li>Merge <code>staging</code> ‚Üí <code>main</code> ‚Üí approbation manuelle requise</li>
                    <li>D√©ploiement planifi√© (heures creuses)</li>
                    <li>Rollback rapide en cas de probl√®me</li>
                </ul>
            </div>

            <h3>4.4 Infrastructure Azure</h3>

            <h4>Services Utilis√©s</h4>
            <div class="mermaid">
flowchart TB
    subgraph Azure["‚òÅÔ∏è Infrastructure Azure"]
        AppService["Azure App Service<br/>(Node.js 18)"]
        AppInsights["Application Insights<br/>(Monitoring)"]
        KeyVault["Key Vault<br/>(Secrets)"]
        AzureAD["Azure AD<br/>(Auth)"]
        
        AppService --> AppInsights
        AppService --> KeyVault
        AppService --> AzureAD
    end
    
    IFS["‚òÅÔ∏è IFS Cloud<br/>(External)"] --> AppService
    
    style Azure fill:#0078d4,stroke:#005a9e,color:#fff
    style AppService fill:#2ecc71,stroke:#27ae60,color:#fff
    style AppInsights fill:#f39c12,stroke:#d68910,color:#fff
    style KeyVault fill:#e74c3c,stroke:#c0392b,color:#fff
    style AzureAD fill:#9b59b6,stroke:#7d3c98,color:#fff
    style IFS fill:#34495e,stroke:#2c3e50,color:#fff
            </div>

            <div class="highlight-box">
                <p><strong>Ressources :</strong></p>
                <ul>
                    <li><strong>Azure App Service</strong> : H√©bergement de l'application Next.js</li>
                    <li><strong>Application Insights</strong> : Monitoring, logs, alertes</li>
                    <li><strong>Key Vault</strong> : Stockage s√©curis√© des secrets (API keys, tokens)</li>
                    <li><strong>Azure AD</strong> : Authentification et gestion des identit√©s</li>
                </ul>

                <p><strong>Monitoring & Alertes :</strong></p>
                <ul>
                    <li>‚úÖ Temps de r√©ponse API</li>
                    <li>‚úÖ Taux d'erreur</li>
                    <li>‚úÖ Disponibilit√© (uptime)</li>
                    <li>‚úÖ Utilisation ressources (CPU, RAM)</li>
                    <li>‚úÖ Logs centralis√©s</li>
                </ul>
            </div>
        </section>

        <section id="section-5">
            <h2>5. √âvolutions Futures</h2>

            <h3>5.1 Am√©liorations Planifi√©es Court Terme</h3>

            <h4>Boat Configuration Editor : Imprimantes Favorites</h4>
            <div class="highlight-box warning">
                <p><strong>Probl√®me actuel :</strong> L'utilisateur doit s√©lectionner l'imprimante √† chaque impression.</p>
            </div>
            <div class="highlight-box success">
                <p><strong>Solution propos√©e :</strong> M√©moriser les pr√©f√©rences utilisateur.</p>
            </div>

            <div class="mermaid">
flowchart LR
    User["üë§ Utilisateur"] --> First["1√®re utilisation<br/>S√©lection imprimante"]
    First --> Save["üíæ Sauvegarde<br/>pr√©f√©rence"]
    Save --> Next["Prochaine<br/>utilisation"]
    Next --> Auto["üéØ Pr√©-s√©lection<br/>automatique"]
    Auto --> Modify["‚úèÔ∏è Modification<br/>possible"]
    
    style User fill:#34495e,stroke:#2c3e50,color:#fff
    style First fill:#3498db,stroke:#2980b9,color:#fff
    style Save fill:#2ecc71,stroke:#27ae60,color:#fff
    style Auto fill:#f39c12,stroke:#d68910,color:#fff
            </div>

            <div class="highlight-box">
                <p><strong>Fonctionnalit√©s :</strong></p>
                <ul>
                    <li>‚úÖ Sauvegarde imprimante favorite par utilisateur</li>
                    <li>‚úÖ Sauvegarde langue pr√©f√©r√©e</li>
                    <li>‚úÖ Pr√©-s√©lection automatique au prochain usage</li>
                    <li>‚úÖ Possibilit√© de modifier √† tout moment</li>
                </ul>

                <p><strong>Stockage :</strong></p>
                <ul>
                    <li>Option 1 : Local Storage (navigateur)</li>
                    <li>Option 2 : Base de donn√©es avec profil utilisateur</li>
                    <li><strong>Recommandation</strong> : Local Storage pour MVP, base de donn√©es pour V2</li>
                </ul>
            </div>

            <h4>Part Printer : Filtres Pr√©d√©finis</h4>
            <p><strong>Fonctionnalit√© :</strong> Sauvegarder des combinaisons de filtres fr√©quentes.</p>
            <p><strong>Exemple :</strong></p>
            <ul>
                <li>"BDR - Ligne MASSIF - D√©bit"</li>
                <li>"FR017 - Toutes lignes - Red√©bit"</li>
            </ul>
        </section>

        <section>
            <h2>Conclusion</h2>
            <p>Le <strong>Manufacturing Portal</strong> repr√©sente une approche moderne et √©volutive du d√©veloppement d'outils de production. En mutualisant l'infrastructure commune et en standardisant l'architecture, nous garantissons :</p>

            <div class="highlight-box success">
                <ul>
                    <li>‚úÖ <strong>Rapidit√©</strong> : D√©veloppement acc√©l√©r√© des nouveaux outils</li>
                    <li>‚úÖ <strong>Qualit√©</strong> : Standards uniformes et code test√©</li>
                    <li>‚úÖ <strong>√âvolutivit√©</strong> : Architecture pr√™te pour 10+ outils</li>
                    <li>‚úÖ <strong>Maintenance</strong> : Corrections et am√©liorations partag√©es</li>
                    <li>‚úÖ <strong>Exp√©rience utilisateur</strong> : Interface coh√©rente et intuitive</li>
                </ul>
            </div>
        </section>
    </div>

    <footer>
        <p><strong>D√©veloppement</strong></p>
        <p><strong>Romain BOTTERO</strong> - Alternant Concepteur d'Application</p>
        <br>
        <p><strong>Documentation & Support</strong></p>
        <p><strong>Marc TOCQUARD</strong> - Chef de Projet Informatique (Documentation ant√©rieure)</p>
        <br>
        <p><strong>Date de mise √† jour :</strong> 16 octobre 2025</p>
        <p><strong>Version :</strong> 1.0</p>
    </footer>

    <div class="scroll-to-top" id="scrollToTop">
        ‚Üë
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Scroll to top button
        const scrollToTopBtn = document.getElementById('scrollToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>